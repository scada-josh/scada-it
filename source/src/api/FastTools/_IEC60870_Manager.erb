
	/**
	 *
	 * @apiName IEC60870_Manager
	 * @apiGroup Fast_Tools
	 * @apiVersion 0.1.0
	 *
	 * @api {post} /FastToolsAPI/IEC60870_Manager/ IEC60870_Manager
	 * @apiDescription คำอธิบาย : ในส่วนนี้ใช้สำหรับสร้าง FAST/TOOLS Quickload สำหรับโปรโตคอล IEC60870-5-104
	 *
	 *
	 *
	 * @apiParam {String} rtu_install = "SERVICE" คำอธิบายกลุ่มของอุปกรณ์ เช่น SERVICE, PRODUCTION, OTHER
	 * @apiParam {String} fasttools_destination = "ABB CTU800" คำอธิบายชนิดของอุปกรณ์ เช่น ABB CTU800
     * @apiParam {Object[]} listDM  รายการ DM
     * @apiParam {String} listDM.name = "DM-01-01-01-01" ชื่อ DM
     *
     * @apiParamExample {json} Request-Example (ตัวอย่าง Payload, Content-Type: application/json):
     *  {
     *      "rtu_install": "SERVICE",
     *      "fasttools_destination": "ABB CTU800",
     *      "listDM": [
     *          {
     *              "name": "DM-01-01-01-01"
     *          },
     *          {
     *              "name": "DM-01-01-01-02"
     *          },
     *          {
     *              "name": "DM-01-01-01-03"
     *          }
     *      ]
     *  }
     *
	 * @apiSampleRequest /FastToolsAPI/IEC60870_Manager/
	 *
	 * @apiSuccess (คำอธิบายผลลัพธ์ (กรณีส่งค่ากลับสำเร็จ Success 200)) {String} msg แสดงข้อความทักทายผู้ใช้งาน
	 *
	 * @apiSuccessExample Example data on success:
     *  {
     *      "result": "success",
     *      "rows": [
     *          {
     *              "filename": "Quickload_for_IEC60870(PGIM_WTDC)_2015-08-15_1439607474.xls",
     *              "path": "http://localhost/scada-it/build/files/Quickload_for_IEC60870(PGIM_WTDC)_2015-08-15_1439607474.xls"
     *          }
     *      ]
     *  }
	 *
	 * @apiError (คำอธิบายผลลัพธ์ (กรณีเกิด Error 4xx)) UserNotFound The <code>id</code> of the User was not found.
	 * @apiErrorExample {json} Error-Response:
	 *     HTTP/1.1 404 Not Found
	 *     {
	 *       "error": "UserNotFound"
	 *     }
	 *
	 */
    function IEC60870_Manager($app, $pdo, $db, $objPHPExcel) {

        /* ************************* */
        /* เริ่มกระบวนการรับค่าพารามิเตอร์จากส่วนของ Payload ซึ่งอยู่ในรูปแบบ JSON */
        /* ************************* */
        $headers = $app->request->headers;
        $ContetnType = $app->request->headers->get('Content-Type');

        /**
        * apidoc @apiSampleRequest, iOS RESTKit use content-type is "application/json"
        * Web Form, Advance REST Client App use content-type is "application/x-www-form-urlencoded"
        */
        if (($ContetnType == "application/json") || ($ContetnType == "application/json; charset=utf-8")) {

	        $request = $app->request();
	        $result = json_decode($request->getBody());

	        /* receive request */
	        $paramRtuInstall = $result->rtu_install;
	        $paramFastToolsDestination = $result->fasttools_destination;
	        $paramListDM = $result->listDM;

 
		} else if ($ContetnType == "application/x-www-form-urlencoded"){

		    //$userID = $app->request()->params('userID_param');
		    //$userID = $app->request()->post('userID_param');
		}


		/* ************************* */
        /* เริ่มกระบวนการเชื่อมต่อกับฐานข้อมูล MySQL */
        /* ************************* */

        $reports = array();
		
		
		/*  IEC60870_LINE_DF Partial */
	    <%= partial "/FastTools/IEC60870/_IEC60870_LINE_DF" %>
	    /*  IEC60870_STATION_DF Partial */
	    <%= partial "/FastTools/IEC60870/_IEC60870_STATION_DF" %>
	    /*  IEC60870_POINT_DF Partial */
	    <%= partial "/FastTools/IEC60870/_IEC60870_POINT_DF" %>

	    /*  STATION_DF Partial */
	    <%= partial "/FastTools/COMMON/_SECTION_DF" %>
	    /*  ITEM_DF Partial */
	    <%= partial "/FastTools/COMMON/_ITEM_DF" %>
	    /*  OBJECT_DF Partial */
	    <%= partial "/FastTools/COMMON/_OBJECT_DF" %>
	    /*  ITEM_HIS_DF Partial */
	    <%= partial "/FastTools/COMMON/_ITEM_HIS_DF" %>






		/* ************************* */
        /* เริ่มกระบวนการสร้าง Excel file */
        /* ************************* */

		// Set document properties
		$objPHPExcel->getProperties()->setCreator("Maarten Balliauw")
									 ->setLastModifiedBy("Maarten Balliauw")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("Test document for Office 2007 XLSX, generated using PHP classes.")
									 ->setKeywords("office 2007 openxml php")
									 ->setCategory("Test result file");


		// Redirect output to a client’s web browser (Excel5)
		header('Content-Type: application/vnd.ms-excel');
		header('Content-Disposition: attachment;filename="01simple.xls"');
		header('Cache-Control: max-age=0');
		// If you're serving to IE 9, then the following may be needed
		header('Cache-Control: max-age=1');

		// If you're serving to IE over SSL, then the following may be needed
		header ('Expires: Mon, 26 Jul 1997 05:00:00 GMT'); // Date in the past
		header ('Last-Modified: '.gmdate('D, d M Y H:i:s').' GMT'); // always modified
		header ('Cache-Control: cache, must-revalidate'); // HTTP/1.1
		header ('Pragma: public'); // HTTP/1.0

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel5');
		$date = new DateTime();
		$fileName = 'Quickload_for_IEC60870('.$paramFastToolsDestination.')'.'_'.date("Y-m-d").'_'.$date->getTimestamp().'.xls';
		$filePath = '../../files/'.$fileName;
		$objWriter->save($filePath);



	    /* ************************* */
	    /* เริ่มกระบวนการส่งค่ากลับ */
	    /* ************************* */
	    $reports[] = array(
	    		"filename" => $fileName,
	    		"path" => url()."/scada-it/build/files/".$fileName
	    	);


	    $resultText = "success";

	    $reportResult = array("result" =>  $resultText, "rows" => $reports);
	    //$reportResult = array("result" =>  $resultText);

	    $app->response()->header("Content-Type", "application/json");
	    echo json_encode($reportResult);


    }