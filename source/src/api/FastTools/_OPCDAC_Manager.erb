
	/**
	 *
	 * @apiName OPCDAC_Manager
	 * @apiGroup Fast_Tools
	 * @apiVersion 0.1.0
	 *
	 * @api {post} /FastToolsAPI/OPCDAC_Manager/ OPCDAC_Manager
	 * @apiDescription คำอธิบาย : ในส่วนนี้ใช้สำหรับสร้าง FAST/TOOLS Quickload สำหรับโปรโตคอล OPCDAC
	 *
	 *
	 *
	 * @apiParam {String} rtu_install = "SERVICE" คำอธิบายกลุ่มของอุปกรณ์ เช่น SERVICE, PRODUCTION, OTHER
	 * @apiParam {String} fasttools_destination = "DCXII" คำอธิบายชนิดของอุปกรณ์ เช่น <br/> <b style='color:red'>PGIM_BRANCH</b> หมายถึงการเชื่อมต่อระหว่าง Fast/Tools กับ PGIM ที่สาขาผ่านทาง DCOM, <br/> <b style='color:red'>DCXII</b> หมายถึงการเชื่อมต่อระหว่าง Fast/Tools กับ DCXII ผ่านทางโปรแกรม KEPWareEx , <br/> <b style='color:red'>PGIM_WTDC</b> หมายถึงการเชื่อมต่อระหว่าง Fast/Tools กับ PGIM ที่ ฝคจ. ผ่านทางโปรแกรม Matrikon Tunneller
     * @apiParam {Object[]} listDM  รายการ DM
     * @apiParam {String} listDM.name = "DM-01-01-01-01" ชื่อ DM
     *
     * @apiParamExample {json} Request-Example (ตัวอย่าง Payload, Content-Type: application/json):
     *  {
     *      "rtu_install": "SERVICE",
     *      "fasttools_destination": "PGIM_BRANCH",
     *      "listDM": [
     *          {
     *              "name": "DM-04-03-01-01"
     *          },
     *          {
     *              "name": "DM-17-03-04-02"
     *          },
     *          {
     *              "name": "DM-17-07-02-01"
     *          },
     *          {
     *              "name": "DM-13-07-07-01"
     *          }
     *      ]
     *  }
     *
	 * @apiSampleRequest /FastToolsAPI/OPCDAC_Manager/
	 *
	 * @apiSuccess (คำอธิบายผลลัพธ์ (กรณีส่งค่ากลับสำเร็จ Success 200)) {String} msg แสดงข้อความทักทายผู้ใช้งาน
	 *
	 * @apiSuccessExample Example data on success:
     *  {
     *      "result": "success",
     *      "rows": [
     *          {
     *              "filename": "Quickload_for_OPCDAC(PGIM_WTDC)_2015-08-15_1439607474.xls",
     *              "path": "http://localhost/scada-it/build/files/Quickload_for_OPCDAC(PGIM_WTDC)_2015-08-15_1439607474.xls"
     *          }
     *      ]
     *  }
	 *
	 * @apiError (คำอธิบายผลลัพธ์ (กรณีเกิด Error 4xx)) UserNotFound The <code>id</code> of the User was not found.
	 * @apiErrorExample {json} Error-Response:
	 *     HTTP/1.1 404 Not Found
	 *     {
	 *       "error": "UserNotFound"
	 *     }
	 *
	 */
    function OPCDAC_Manager($app, $pdo, $db, $objPHPExcel) {

        /* ************************* */
        /* เริ่มกระบวนการรับค่าพารามิเตอร์จากส่วนของ Payload ซึ่งอยู่ในรูปแบบ JSON */
        /* ************************* */
        $headers = $app->request->headers;
        $ContetnType = $app->request->headers->get('Content-Type');

        /**
        * apidoc @apiSampleRequest, iOS RESTKit use content-type is "application/json"
        * Web Form, Advance REST Client App use content-type is "application/x-www-form-urlencoded"
        */
        if ($ContetnType == "application/json") {

	        $request = $app->request();
	        $result = json_decode($request->getBody());

	        /* receive request */
	        $paramRtuInstall = $result->rtu_install;
	        $paramFastToolsDestination = $result->fasttools_destination;
	        $paramListDM = $result->listDM;

 
		} else if ($ContetnType == "application/x-www-form-urlencoded"){

		    //$userID = $app->request()->params('userID_param');
		    //$userID = $app->request()->post('userID_param');
		}


		/* ************************* */
        /* เริ่มกระบวนการเชื่อมต่อกับฐานข้อมูล MySQL */
        /* ************************* */

        $reports = array();

		/*  OPCDAC_LINE_DF Partial */
	    <%= partial "/FastTools/OPCDAC/_OPCDAC_LINE_DF" %>

	    /*  OPCDAC_GROUP_DF Partial */
	    <%= partial "/FastTools/OPCDAC/_OPCDAC_GROUP_DF" %>

		/*  OPCDAC_STATION_DF Partial */
	    <%= partial "/FastTools/OPCDAC/_OPCDAC_STATION_DF" %>

	    /*  OPCDAC_POINT_DF Partial */
	    <%= partial "/FastTools/OPCDAC/_OPCDAC_POINT_DF" %>

	    /*  SECTION_DF Partial */
	    <%= partial "/FastTools/COMMON/_SECTION_DF" %>

	    /*  ITEM_DF Partial */
	    <%= partial "/FastTools/COMMON/_ITEM_DF" %>

	    /*  OBJECT_DF Partial */
	    <%= partial "/FastTools/COMMON/_OBJECT_DF" %>

	    /*  ITEM_HIS_DF Partial */
	    <%= partial "/FastTools/COMMON/_ITEM_HIS_DF" %>

		/* ************************* */
        /* เริ่มกระบวนการสร้าง Excel file */
        /* ************************* */

		// Set document properties
		$objPHPExcel->getProperties()->setCreator("Maarten Balliauw")
									 ->setLastModifiedBy("Maarten Balliauw")
									 ->setTitle("Office 2007 XLSX Test Document")
									 ->setSubject("Office 2007 XLSX Test Document")
									 ->setDescription("Test document for Office 2007 XLSX, generated using PHP classes.")
									 ->setKeywords("office 2007 openxml php")
									 ->setCategory("Test result file");


		// Redirect output to a client’s web browser (Excel5)
		header('Content-Type: application/vnd.ms-excel');
		header('Content-Disposition: attachment;filename="01simple.xls"');
		header('Cache-Control: max-age=0');
		// If you're serving to IE 9, then the following may be needed
		header('Cache-Control: max-age=1');

		// If you're serving to IE over SSL, then the following may be needed
		header ('Expires: Mon, 26 Jul 1997 05:00:00 GMT'); // Date in the past
		header ('Last-Modified: '.gmdate('D, d M Y H:i:s').' GMT'); // always modified
		header ('Cache-Control: cache, must-revalidate'); // HTTP/1.1
		header ('Pragma: public'); // HTTP/1.0

		$objWriter = PHPExcel_IOFactory::createWriter($objPHPExcel, 'Excel5');
		$date = new DateTime();
		$fileName = 'Quickload_for_OPCDAC('.$paramFastToolsDestination.')'.'_'.date("Y-m-d").'_'.$date->getTimestamp().'.xls';
		$filePath = '../../files/'.$fileName;
		$objWriter->save($filePath);



	    /* ************************* */
	    /* เริ่มกระบวนการส่งค่ากลับ */
	    /* ************************* */
	    $reports[] = array(
	    		"filename" => $fileName,
	    		"path" => url()."/scada-it/build/files/".$fileName
	    	);


	    $resultText = "success";

	    $reportResult = array("result" =>  $resultText, "rows" => $reports);
	    //$reportResult = array("result" =>  $resultText);

	    $app->response()->header("Content-Type", "application/json");
	    echo json_encode($reportResult);


	    // $return_m = array("msg" => "Hello, Current PHP version: ". phpversion());
	    // echo json_encode($return_m);


    }