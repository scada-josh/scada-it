		$sheetCount = $objPHPExcel->getSheetCount();

		/* Create Worksheet พร้อมกำหนดชื่อ */
		$objPHPExcel_ITEM_HIS_DF_Worksheet = new \PHPExcel_Worksheet($objPHPExcel, 'ITEM_HIS_DF');
		$objPHPExcel->addSheet($objPHPExcel_ITEM_HIS_DF_Worksheet, $sheetCount);
		$objPHPExcel_ITEM_HIS_DF_Worksheet->setTitle('ITEM_HIS_DF');

		/* กำหนดให้เป็น ActiveWorkSheet */
		// Set active sheet index to the first sheet, so Excel opens this as the first sheet
		$objPHPExcel->setActiveSheetIndex($sheetCount);


		/* Create Header */
		//$reports = $db->modbus_point_df[1];
		$results_header_item_his_df = $db->item_his_df()->where("templates = ?", "header_template")->fetch();

		$sth_item_his_df = $pdo->prepare("SELECT * FROM item_his_df WHERE templates = 'header_template'");
		$sth_item_his_df->execute();
		/* Count the number of columns in the (non-existent) result set */
		$numCols_item_his_df = $sth_item_his_df->columnCount();
		$startRow_item_his_df = 2;
		$startColumn_item_his_df = 4;

		for ($i = $startColumn_item_his_df; $i < $numCols_item_his_df; $i++) {
			$meta = $sth_item_his_df->getColumnMeta($i);

			$row = 1;		// แถวที่ 1 ของ Excel
			$col = $i-$startColumn_item_his_df;
			$tmpValue = $results_header_item_his_df[$meta['name']];
			$value = trim(preg_replace('/\t+/', '', $tmpValue));
			$objPHPExcel->getActiveSheet()->setCellValueByColumnAndRow($col, $row, $value);
		}




		/* Create Details */

		$numDM = count($paramListDM);  // จำนวน DM
		$z=1;
		for ($j=$startRow_item_his_df; $j < $numDM+$startRow_item_his_df; $j++) { 

			$results_data_item_his_dfs = $db->item_his_df()->where("templates = ? and rtu_install = ? and fasttools_destination = ?", "data_template", $paramRtuInstall, $paramFastToolsDestination);

			$k = 0;  // จำนวนแภวของ Template
			foreach ($results_data_item_his_dfs as $results_data_item_his_df) {

					$z = $z +1;
					for ($i = $startColumn_item_his_df; $i < $numCols_item_his_df; $i ++) {
						$meta = $sth_item_his_df->getColumnMeta($i);
						$row = $z;		// แถวที่ $row ของ Excel
						$col = $i-$startColumn_item_his_df;	// คอลัมภ์ที่ $col ของ Excel

// TEN_SECONDS:SERVICE.B01.DM-01-06-03-02.FT
// TEN_SECONDS:SERVICE.B01.DM-01-06-03-02.PT_INT
// TEN_SECONDS:SERVICE.B01.DM-01-06-03-02.PT_EXT

						if ($meta['name'] == "NAME") {

							$tmpDM_Name = $paramListDM[$j-$startRow_item_his_df]->name;
							$tmpBranch_Name = "B".substr($tmpDM_Name, 3, 2);

							$tmpValue = $results_data_item_his_df[$meta['name']];

							if($paramRtuInstall == "PRODUCTION") {
								// TEN_SECONDS:PRODUCTION.WTDC.U208.FT
								if ((substr($tmpValue, -2) == "FT")) {
									$value = $results_data_item_his_df['GROUP_NAME'].":".$paramRtuInstall.".WTDC.".$tmpDM_Name.".FT";
								} else if ((substr($tmpValue, -2) == "PT")) {
									$value = $results_data_item_his_df['GROUP_NAME'].":".$paramRtuInstall.".WTDC.".$tmpDM_Name.".PT";
								} else {
									$value = "N/A";
								}

							} else {
								// TEN_SECONDS:SERVICE.B02.DM-02-02-08-01.PT_EXT
								if ((substr($tmpValue, -2) == "FT")) {
									$value = $results_data_item_his_df['GROUP_NAME'].":".$paramRtuInstall.".".$tmpBranch_Name.".".$tmpDM_Name.".FT";
								} else if ((substr($tmpValue, -6) == "PT_INT")) {
									$value = $results_data_item_his_df['GROUP_NAME'].":".$paramRtuInstall.".".$tmpBranch_Name.".".$tmpDM_Name.".PT_INT";
								} else if ((substr($tmpValue, -6) == "PT_EXT")) {
									$value = $results_data_item_his_df['GROUP_NAME'].":".$paramRtuInstall.".".$tmpBranch_Name.".".$tmpDM_Name.".PT_EXT";
								}

							}

							

						} else {
							$tmpValue = $results_data_item_his_df[$meta['name']];
							$value = trim(preg_replace('/\t+/', '', $tmpValue));
						}
						
						

						$objPHPExcel->getActiveSheet()->setCellValueByColumnAndRow($col, $row, $value);
					}
				$k = $k +1;

			}

		}