---
title: SCADA IT - API (Python)
layout: "layout-blank"
---
# -- coding: utf-8 --

from flask import Flask, jsonify, request, json, make_response
from flask.ext.cors import CORS
from flask_restful import Resource, Api, reqparse, abort
from flask.ext.sqlalchemy import SQLAlchemy

from flask.ext.httpauth import HTTPBasicAuth
auth = HTTPBasicAuth()

@auth.get_password
def get_password(username):
    if username == 'miguel':
        return 'python'
    return None

@auth.error_handler
def unauthorized():
    return make_response(jsonify({'error': 'Unauthorized access'}), 401)



<%= partial "/models/_appointment" %>

from datetime import timedelta
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker

 
app = Flask(__name__, static_url_path="")
api = Api(app)
# app.config['SQLALCHEMY_DATABASE_URI'] = 'mysql://root:@127.0.0.1:3306/flask_db'
# db = SQLAlchemy(app)

engine = create_engine('mysql://root:@127.0.0.1:3306/flask_db')
Base.metadata.create_all(engine)
Session = sessionmaker(bind=engine)
session = Session()
now = datetime.now()


"""
@api {get} /hello Test RESTful with Flask 
@apiName hello
@apiGroup TEST
@apiSampleRequest /hello
"""
@app.route('/hello')
def helloWorld():
    if db.session.query("1").from_statement("SELECT 1").all():
        # return 'It works.'
        temp = "It works"
    else:
        # return 'Something is broken.'
        temp = "Somthing is broken."
    return jsonify({'tasks': temp})
    # return jsonify({'tasks': 'hello'})


# TEST #
<%= partial "/TEST/_HelloWorld" %>
<%= partial "/TEST/_postJSON" %>
<%= partial "/TEST/_loginAuth" %>

"""
@api {get} /insert_appointment เพิ่ม Appointment
@apiName insertAppointment
@apiGroup Appointment
@apiSampleRequest /insert_appointment
"""
class insertAppointment(Resource):
    def get(self):
        session.add(Appointment(
            title='Important Meeting',
            start=now + timedelta(days=3),
            end=now + timedelta(days=3, seconds=3600),
            allday=False,
            location='The Office'))
        session.commit()
        return {'hello': 'world (GET)'}

    # def post(self, todo_id):
    #     # todos[todo_id] = request.form['data']
    #     app.logger.debug('# todo_id #\n' + repr(todo_id))
    #     return {'hello': 'Hello'+ repr(todo_id) +' (POST)'}




# Hello World #
api.add_resource(HelloWorld, '/hello_world/<string:todo_id>')
api.add_resource(postJSON, '/post_json')
api.add_resource(loginAuth, '/login_auth')

# CRUD Database #
api.add_resource(insertAppointment, '/insert_appointment')


if __name__ == '__main__':
    app.debug = True
    app.run(host='0.0.0.0', port=5000)